function threeD(){function e(){}function t(e,t){U=e;var a=[];e.forEach(function(e,t){var n=Z([e.longitude,e.latitude]);e.x=parseInt(n[0]),e.y=-parseInt(n[1]),e.xr=e.x+Math.random(),e.yr=e.y+Math.random(),e.percentage=parseInt(e.percentage),e.z=L(e.percentage),e.name=t,e.xx=parseInt(e.xx),e.yy=parseInt(e.yy),e.social=[],e.cube=null,a[e.xx]||(a[e.xx]=[]),a[e.xx][e.yy]=e}),t.forEach(function(e){var t=a[e.x][e.y];e.x=t.x,e.y=t.y,e.z=t.z,e.xr=t.xr,e.yr=t.yr,e.instagram*=1,e.twitter*=1,e.hour*=1,t.social[e.hour]={twitter:e.twitter,instagram:e.instagram}});var i=d3.nest().key(function(e){return e.bezirk}).entries(e),r=i.map(function(e){return f(e)}),c=d3.nest().key(function(e){return e.hour}).entries(t);N.on("click",function(){if(!d3.event.defaultPrevented){if(C.active===Q){C.active=Q=null,r.forEach(function(e){e.material.wireframe=!1,e.material.opacity=1,e.material.color.setHex(7261685),e.intersected=!1});var e=new TWEEN.Tween(R.position).to({x:0,y:0},1e3).easing(TWEEN.Easing.Quadratic.InOut).start(),t=new TWEEN.Tween({scale:W.scale()}).to({scale:1},1e3).onUpdate(function(e){W.scale(this.scale).event(N)}).easing(TWEEN.Easing.Quadratic.InOut).start()}if(Q){var n=Q.geometry.boundingBox.center().negate(),a=new TWEEN.Tween(R.position).to({x:n.x,y:n.y},1e3).easing(TWEEN.Easing.Quadratic.InOut).start(),i=new TWEEN.Tween({scale:W.scale()}).to({scale:3},1e3).onUpdate(function(e){W.scale(this.scale).event(N)}).easing(TWEEN.Easing.Quadratic.InOut).start();r.forEach(function(e){e.material.wireframe=!e.intersected,e.material.opacity=e.intersected?1:.6}),C.active=Q}}});var s=0;m(e,s),n(),o()}function n(){y.forEach(function(e,t,n){var a=e.c,i=new THREE.SphereGeometry(10,10,10),r=new THREE.MeshBasicMaterial({color:16777215}),o=new THREE.Mesh(i,r);o.position.x=a[0],o.position.y=-a[1],o.position.z=100,o.visible=!1;var c=document.createElement("span");c.innerHTML=e.n,o.domlabel=document.createElement("div"),o.domlabel.appendChild(c),o.domlabel.style.display="none",document.getElementById("labels").appendChild(o.domlabel),R.add(o),K.push(o)})}function a(){D.setFromCamera(G,k);var e=D.intersectObjects(R.children);e.length>0?Q!==e[0].object&&e[0].object.hasOwnProperty("bezirk")&&(Q&&(Q.material.color.setHex(Q.currentHex),Q.position.z=0,Q.material.wireframe=!1,Q.intersected=!1),Q=e[0].object,Q.intersected=!0,Q.currentHex=Q.material.color.getHex(),Q.material.color.setHex(15073330),Q.material.wireframe=!1,x.style.cursor="pointer"):(Q&&(Q.material.color.setHex(Q.currentHex),Q.position.z=0,Q.material.wireframe=!1,Q.intersected=!1),Q=null,x.style.cursor="inherit")}function i(e){(C.play||screenfull.isFullscreen)&&(requestAnimationFrame(i),TWEEN.update(),o(e))}function r(){U.forEach(function(e){e.cube&&(C.instagram?e.cube.visible=!0:e.cube.visible=!1),e.cube2&&(C.twitter?e.cube2.visible=!0:e.cube2.visible=!1)})}function o(e){H.rotation.z+=.001,u(K),(C.twitter||C.instagram)&&(c(e),l()),T.render(z,k),b&&(T.domElement.toBlob(function(e){saveAs(e,"breitband.png")}),b=!1)}function c(e){var t=parseInt(e/J)%24;t!==Y&&(Y=t,s(Y))}function s(e){h.text((10>e?"0"+e:e)+":00"),U.forEach(function(t){var n=t.social[e],a=.2,i=.2,r=_-t.z;n&&(C.instagram&&(a=r+j(n.instagram)),C.twitter&&(i=r+j(n.twitter))),t.cube&&(t.cube.animateZ=a),t.cube2&&(t.cube2.animateZ=i)})}function l(){U.forEach(function(e){e.cube&&(e.cube.position.z+=(e.z-10+e.cube.animateZ-e.cube.position.z)*X,e.cube.scale.z=e.cube.scale.x=e.cube.scale.y+=(e.cube.animateZ/20-e.cube.scale.z)*X),e.cube2&&(e.cube2.position.z+=(e.z-10+e.cube2.animateZ-e.cube2.position.z)*X,e.cube2.scale.z=e.cube2.scale.x=e.cube2.scale.y+=(e.cube2.animateZ/20-e.cube2.scale.z)*X)})}function u(e){for(var t=0;t<e.length;t++){var n=d(e[t]);e[t].domlabel.style.display="block",e[t].domlabel.style.transform="translate("+n.x+"px,"+n.y+"px)"}}function d(e){var t=(new THREE.Vector3).setFromMatrixPosition(e.matrixWorld).project(k),n=(t.x+1)/2*g,a=(-t.y+1)/2*w;return{x:n,y:a}}function p(e,t,n){var a=e.filter(function(e){return e.hour===n})[0];return a?j(a[t]):0}function m(e,t){var n=new THREE.BoxGeometry(5,5,5);n.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,.5));var a=new THREE.MeshLambertMaterial({color:15073330,opacity:.9,transparent:!1}),i=new THREE.MeshLambertMaterial({color:13956702,opacity:.9,transparent:!1}),o=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.8,fog:!1});e.forEach(function(e){var t;e.social.filter(function(e){return 0!==e.instagram}).length>0&&(t=new THREE.Mesh(n,a),t.position.x=e.x,t.position.y=e.y,t.position.z=e.z,t.visible=!0,e.cube=t,R.add(t)),e.social.filter(function(e){return 0!==e.twitter}).length>0&&(t=new THREE.Mesh(n,i),t.position.x=e.x+10,t.position.y=e.y,t.position.z=e.z,t.visible=!0,e.cube2=t,R.add(t))}),r()}function f(e){var t=e.values,n=V.triangles(t),a=new THREE.Geometry;a.vertices=t.map(function(e,t){return e.id=t,new THREE.Vector3(e.x,e.y,e.z)}),n.forEach(function(e){var t=(Math.abs(e[0].x-e[1].x)+Math.abs(e[1].x-e[2].x)+Math.abs(e[0].x-e[2].x))/3,n=(Math.abs(e[0].y-e[1].y)+Math.abs(e[1].y-e[2].y)+Math.abs(e[0].y-e[2].y))/3;t>20||n>20||a.faces.push(new THREE.Face3(e[0].id,e[1].id,e[2].id))}),a.computeFaceNormals(),a.computeBoundingBox();var i=new THREE.MeshLambertMaterial({color:7261685,side:THREE.BackSide,wireframe:!1,transparent:!0}),r=new THREE.Mesh(a,i);return r.bezirk=e.key,R.add(r),r}function E(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],a=new ArrayBuffer(t.length),i=new Uint8Array(a),r=0;r<t.length;r++)i[r]=t.charCodeAt(r);var o=new DataView(a),c=new Blob([o],{type:n});return c}var y=[{c:[-164.94678225444946,-63.029871437100326],n:"Mitte"},{c:[52.778130057326905,103.42041724165729],n:"Friedrichshain-Kreuzberg"},{c:[94.44270055577594,-432.5721103772772],n:"Pankow"},{c:[-499.09505521863184,119.66473570559107],n:"Charlottenburg-Wilmersdorf"},{c:[-818.1448708597577,-22.566868616095963],n:"Spandau"},{c:[-607.8190923800062,498.97261500635307],n:"Steglitz-Zehlendorf"},{c:[-113.29687363849465,462.53109998602974],n:"Tempelhof-Schöneberg"},{c:[145.7122760209756,463.22536731944496],n:"Neukölln"},{c:[691.0693806464119,528.9735270041073],n:"Treptow-Köpenick"},{c:[578.0995751704685,4.466256221793847],n:"Marzahn-Hellersdorf"},{c:[337.0342485538481,-74.80341059918459],n:"Lichtenberg"},{c:[-425.4280684254382,-423.6349448086686],n:"Reinickendorf"}];d3.select(".company-help").on("click",function(){d3.select(".company-help").style("display","none")}),d3.select(".infobtn").on("click",function(){d3.select(".company-help").style("display","block")}),d3.select(".instagram").on("click",function(t){C.instagram=!C.instagram,d3.select(this).classed("active",C.instagram),e.updateSocialStatus()}),d3.select(".twitter").on("click",function(t){C.twitter=!C.twitter,d3.select(this).classed("active",C.twitter),e.updateSocialStatus()}),d3.select(".menu .screenshot").on("click",function(e){b=!0});var b=!1,h=d3.select(".time .clock");e.updateSocialStatus=function(){C.twitter||C.instagram?d3.select(".time").style("display","block"):d3.select(".time").style("display","none"),r()},e.resize=function(){var e=d3.select("#container").node().getBoundingClientRect();g=e.width,w=e.height,k.aspect=g/w,k.updateProjectionMatrix(),T.setSize(g,w)},e.play=function(){C.play||(C.play=!0,i())},e.pause=function(){C.play=!1},d3.select(".fullscreen").on("click",function(t){screenfull.toggle(),e.play(),d3.select(this).classed("active",screenfull.isFullscreen)}).style("display",function(){return screenfull.enabled});var v=d3.select("#container").node().getBoundingClientRect(),g=v.width,w=v.height,x=document.getElementById("container"),T=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!1});T.setClearColor(1980305),T.setSize(g,w),x.appendChild(T.domElement);var z=new THREE.Scene,H=new THREE.Scene,R=new THREE.Scene;z.add(H),H.add(R),z.add(new THREE.HemisphereLight(16777215,1980305));var M=new THREE.DirectionalLight(16777215,1);M.position.set(1,100,300),z.add(M);var k=new THREE.PerspectiveCamera(50,g/w,1,1e4);k.position.x=0,k.position.y=-1800,k.position.z=1100,k.lookAt(z.position);var S=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(e){H.rotation.z+=d3.event.dx/100}),B=(new THREE.Vector3).copy(k.position),W=d3.behavior.zoom().scaleExtent([1,5]).on("zoom",function(e){k.position.y=B.y/d3.event.scale,k.position.z=B.z/d3.event.scale,k.lookAt(z.position)}),I=W.scale(),N=d3.select(T.domElement).datum({drag:!1}).call(S).call(W).on("mousemove",function(){var e=d3.mouse(this);G.x=e[0]/g*2-1,G.y=2*-(e[1]/w)+1,C.active||a()}),C={fullscreen:!1,play:!1,active:null,twitter:!1,instagram:!1},F=d3.time.format("%Y-%m-%d").parse,L=d3.scale.linear().range([1,50]).domain([0,5]),j=d3.scale.log().range([1,200]).domain([1,50]),A=d3.scale.log().range(["#fff","#ddd"]).domain([1,200]),P=[13.413215,52.521918],Z=d3.geo.mercator().scale(24e4).center(P).translate([0,0]),O=d3.geo.path().projection(Z),V=d3.geom.voronoi().x(function(e){return e.xr}).y(function(e){return e.yr}),D=new THREE.Raycaster,G=new THREE.Vector2,Q,U;d3.csv("data/50mbit.csv",function(e,n){d3.csv("data/dataNEW.csv",function(e,a){t(n,a)})});var K=[],q=0,Y=0,J=400,X=.05,_=60;try{window.self!==window.top||(C.play=!0,i())}catch(ee){}return e}