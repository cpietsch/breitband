function d3_pulse(){function t(a){r=a,t.init()}var r,a=-1,e,n=[];return t.init=function(){r.each(function(a,i){var s=d3.select(this);s.selectAll("*").remove();var c=3,o=2,l=56,d=235,u=1,p=147,h=200,x=10,f=d-l,y=p-u,g=f*c,m=y*c,v=200,b=r.append("svg").attr("id","timemap").attr("viewBox","0 0 "+g+" "+m).attr("preserveAspectRatio","xMidYMid meet"),w=d3.select("#d3_circular").append("svg").attr("id","timeline").attr("viewBox","0 0 "+v+" "+h).attr("preserveAspectRatio","xMidYMid meet").append("g"),M=0,k=24,A=20,P=v/2-x-5,I=5,_=60,q=30,E=5,L=15,R=function(t,r,a){var e=2*Math.PI/24,n=A+a(r)*(P-A);return[n*Math.cos(t*e-Math.PI/2),n*Math.sin(t*e-Math.PI/2)]},j=function(t,r,a){var e=2*Math.PI/24,n=E+a(r)*(L-E);return[n*Math.cos(t*e-Math.PI/2),n*Math.sin(t*e-Math.PI/2)]},B=w.append("g").attr("class","grid").attr("transform","translate("+v/2+","+h/2+")"),F=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];B.selectAll("line").data(F).enter().append("line").attr("x1",function(t){var r=R(t,1,function(t){return t});return r[0]}).attr("x2",function(t){var r=R(t,0,function(t){return t});return r[0]}).attr("y1",function(t){var r=R(t,1,function(t){return t});return r[1]}).attr("y2",function(t){var r=R(t,0,function(t){return t});return r[1]}).style("stroke",function(t,r){return"rgba(0,0,0,"+(.3/24*r+.1)+")"});var S=d3.svg.arc().innerRadius(A).outerRadius(P).startAngle(function(t){return Math.PI/12*t}).endAngle(function(t){return Math.PI/12*(t+1)});for(B.selectAll("path.bg-pattern").data(F).enter().append("path").attr("class",function(t,r){var a="bg-"+r+" bg-pattern";return a+=r%2===!0?" odd":" even"}).attr("d",S),i=0;I>i;i++)B.append("circle").attr("cx",0).attr("cy",0).attr("r",(P-A)/I*i+A);var U=w.append("defs"),Y=U.append("mask").attr("id","hole");Y.append("rect").attr("x",-v/2).attr("y",-h/2).attr("width",v).attr("height",h).style("fill","white"),Y.append("circle").attr("cx",0).attr("cy",0).attr("r",A),B.append("text").attr("class","timetext").attr("x",0).attr("y",7).attr("text-anchor","middle").text(24),B.append("text").attr("class","octext").attr("x",0).attr("y",-(P+5)).attr("text-anchor","middle").text("00:00"),B.append("text").attr("class","octext").attr("x",0).attr("y",P+13).attr("text-anchor","middle").text("12:00"),B.append("text").attr("class","octext").attr("x",P+5).attr("y",3).attr("text-anchor","start").text("06:00"),B.append("text").attr("class","octext").attr("x",-(P+5)).attr("y",3).attr("text-anchor","end").text("18:00");var Z={},C={},D={},N={cix:null,instagram:null,twitter:null},V={cix:[],instagram:[],twitter:[]},W={cix:"rgba(152,78,163,1)",instagram:"rgba(77,175,74,1)",twitter:"rgba(55,126,184,1)"},X={cix:"rgba(152,78,163,0.2)",instagram:"rgba(77,175,74,0.2)",twitter:"rgba(55,126,184,0.2)"};for(var z in V){for(i=0;24>i;i++)V[z].push(0);Z[z]=w.append("g").attr("transform","translate("+v/2+","+h/2+")"),C[z]=w.append("g").attr("transform","translate("+v/2+","+h/2+")"),D[z]=d3.scale.linear().range([0,1]),N[z]=d3.select("#legend_"+z+" div").append("svg").attr("height",q),"cix"!==z?N[z].attr("width",_):N[z].attr("width",_/2)}d3.json("http://tsb.sebastianmeier.eu/static/info.json",function(r,a){if(r)return console.error(r);for(var e in V){var n=-Number.MAX_VALUE;switch(e){case"cix":for(var i=[66,48,40,32,29,27,23,19,17,16,14,14,14,15,18,20,23,28,32,37,40,45,46,49,53,54,57,60,65,69,67,71,76,74,71,77,75,78,88,74,78,84,83,87,81,74,74,72,66],s=[],c=0;c<i.length;c++)s.push({x:c/2,y:i[c]});break;case"instagram":var s=t.reorder("instagram",a);break;case"twitter":var s=t.reorder("twitter",a)}for(V[e]=s,c=0;c<s.length;c++)s[c].y>n&&(n=s[c].y);D[e].domain([0,n]),Z[e].selectAll("circle").data(V[e]).enter().append("circle").attr("cx",function(t,r){var a=R(t.x,t.y,D[e]);return a[0]}).attr("cy",function(t,r){var a=R(t.x,t.y,D[e]);return a[1]}).style("fill",W[e]).attr("r",1);var o=d3.svg.line().x(function(t,r){var a=R(t.x,t.y,D[e]);return a[0]}).y(function(t,r){var a=R(t.x,t.y,D[e]);return a[1]}),l=d3.svg.line().x(function(t,r){var a=j(t.x,t.y,D[e]);return a[0]}).y(function(t,r){var a=j(t.x,t.y,D[e]);return a[1]});if(C[e].append("path").attr("d",function(){return o(V[e])+" Z"}).style("stroke",W[e]).style("fill",X[e]).attr("mask","url(#hole)").attr("class",e),N[e].append("path").attr("d",function(){return l(V[e])+" Z"}).style("stroke",W[e]).style("fill",X[e]).attr("transform","translate("+q/2+" "+q/2+")"),N[e].append("circle").attr("cx",0).attr("cy",0).attr("r",E-2).style("stroke",W[e]).style("fill","#fff").attr("transform","translate("+q/2+" "+q/2+")"),"cix"!==e)for(N[e].append("line").attr("x1",_/2).attr("x2",_/2).attr("y1",0).attr("y2",q).attr("stroke","rgba(0,0,0,0.2)"),c=0;6>c;c++)N[e].append("circle").attr("cx",_-q+10+Math.random()*(_-q-12)).attr("cy",Math.random()*(q-4)+2).attr("r",2).style("fill",W[e]).style("stroke","none")}});var G,H,J,K,O,Q,T,tt={twitter:null,instagram:null};b.append("image").attr("xlink:href","images/pulse_background_lg.png").attr("x",0).attr("y",0).attr("width",542).attr("height",441);var rt=document.createElement("canvas");rt.width=1084,rt.height=882;var at=rt.getContext("2d");d3.csv("http://tsb.sebastianmeier.eu/static/data.csv",function(r,a){function i(t,r){if(x.forEach(function(t,a,n){var i=t.o,s=t.dx,c=t.dy,o=t.type;e[o][r][s]&&e[o][r][s][c]&&e[o][r][s][c]>0?i=1:(i>0&&(i-=.1),0>i&&(i=0)),x[a].o=i}),2===t){var a=2;at.clearRect(0,0,rt.width,rt.height),x.forEach(function(t,r,e){at.beginPath(),at.arc(t.cx*a,t.cy*a,o/1.5*a,0,2*Math.PI,!1),at.fillStyle=t.c+t.o+")",at.fill(),at.lineWidth=0,at.strokeStyle="transparent",at.stroke(),at.closePath()}),n.push(rt.toDataURL()),b.append("image").attr("xlink:href",n[n.length-1]).attr("x",0).attr("class","animationLayer").attr("id","animationLayer_"+r).attr("y",0).attr("width",542).attr("height",441)}}G=a,e={instagram:[],twitter:[]},H=[];for(var s=0;24>s;s++)for(var d in e)e[d].push([]);a.forEach(function(t,r,a){H[t.x]||(H[t.x]=[]),H[t.x][t.y]=1,e.twitter[t.hour][t.x]||(e.twitter[t.hour][t.x]=[]),e.instagram[t.hour][t.x]||(e.instagram[t.hour][t.x]=[]),e.twitter[t.hour][t.x][t.y]=t.twitter,e.instagram[t.hour][t.x][t.y]=t.instagram}),J=[];for(var p in H)for(var h in H[p])J.push({x:p,y:h});var x=[];J.forEach(function(t,r,a){x.push({cx:(t.x-l)*c+1,cy:(t.y-u)*c+1,dx:t.x,dy:t.y,o:0,c:"rgba(77,175,74,",type:"twitter"}),x.push({cx:(t.x-l)*c-1,cy:(t.y-u)*c-1,dx:t.x,dy:t.y,o:0,c:"rgba(55,126,184,",type:"instagram"})}),Q=d3.max(a,function(t){return Math.sqrt(t.twitter)}),T=d3.min(a,function(t){return Math.sqrt(t.twitter)}),K=d3.max(a,function(t){return Math.sqrt(t.instagram)}),O=d3.min(a,function(t){return Math.sqrt(t.instagram)}),tt.twitter=d3.scale.linear().domain([0,Q]).range([0,1]),tt.instagram=d3.scale.linear().domain([0,K]).range([0,1]);for(var f=1;3>f;f++)for(var y=0;24>y;y++)i(f,y);requestAnimationFrame(t.iterate)})})},t.iterate=function(){a++,a>23&&(a=0),d3.selectAll(".animationLayer").style("display","none"),d3.select("#animationLayer_"+a).style("display","block"),d3.selectAll("path.bg-pattern.odd").style("opacity",.01),d3.selectAll("path.bg-pattern.even").style("opacity",.03);var r=a-2;0>r&&(r+=24);var e=a-3;0>e&&(e+=24);var n=a-4;0>n&&(n+=24),d3.select("path.bg-"+r).style("opacity",.2),d3.select("path.bg-"+e).style("opacity",.1),d3.select("path.bg-"+n).style("opacity",.05),d3.select("path.bg-"+(a-1)).style("opacity",.3),d3.select(".timetext").text(a),requestAnimationFrame(debouncer(t.iterate,100))},t.reorder=function(t,r){var a=[];for(var e in r.histogram[t])a.push({x:e,y:parseInt(r.histogram[t][e])});return a},t}