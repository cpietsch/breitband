function d3_pulse(){function t(a){r=a,t.init()}var r,a=-1,e,n=[];return t.init=function(){r.each(function(a,e){var n=d3.select(this);n.selectAll("*").remove();var i=3,s=2,l=56,c=235,o=1,d=147,p=200,u=10,x=c-l,y=d-o,h=x*i,f=y*i,g=200,v=r.append("svg").attr("id","timemap").attr("viewBox","0 0 "+h+" "+f).attr("preserveAspectRatio","xMidYMid meet"),m=d3.select("#d3_circular").append("svg").attr("id","timeline").attr("viewBox","0 0 "+g+" "+p).attr("preserveAspectRatio","xMidYMid meet").append("g"),b=0,M=24,w=20,A=g/2-u-5,k=5,I=60,_=30,P=5,L=15,R=function(t,r,a){var e=2*Math.PI/24,n=w+a(r)*(A-w);return[n*Math.cos(t*e-Math.PI/2),n*Math.sin(t*e-Math.PI/2)]},j=function(t,r,a){var e=2*Math.PI/24,n=P+a(r)*(L-P);return[n*Math.cos(t*e-Math.PI/2),n*Math.sin(t*e-Math.PI/2)]},q=m.append("g").attr("class","grid").attr("transform","translate("+g/2+","+p/2+")"),B=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23];q.selectAll("line").data(B).enter().append("line").attr("x1",function(t){var r=R(t,1,function(t){return t});return r[0]}).attr("x2",function(t){var r=R(t,0,function(t){return t});return r[0]}).attr("y1",function(t){var r=R(t,1,function(t){return t});return r[1]}).attr("y2",function(t){var r=R(t,0,function(t){return t});return r[1]}).style("stroke",function(t,r){return"rgba(0,0,0,"+(.3/24*r+.1)+")"});var F=d3.svg.arc().innerRadius(w).outerRadius(A).startAngle(function(t){return Math.PI/12*t}).endAngle(function(t){return Math.PI/12*(t+1)});for(q.selectAll("path.bg-pattern").data(B).enter().append("path").attr("class",function(t,r){var a="bg-"+r+" bg-pattern";return a+=r%2===!0?" odd":" even"}).attr("d",F),e=0;k>e;e++)q.append("circle").attr("cx",0).attr("cy",0).attr("r",(A-w)/k*e+w);var Y=m.append("defs"),Z=Y.append("mask").attr("id","hole");Z.append("rect").attr("x",-g/2).attr("y",-p/2).attr("width",g).attr("height",p).style("fill","white"),Z.append("circle").attr("cx",0).attr("cy",0).attr("r",w),q.append("text").attr("class","timetext").attr("x",0).attr("y",7).attr("text-anchor","middle").text(24),q.append("text").attr("class","octext").attr("x",0).attr("y",-(A+5)).attr("text-anchor","middle").text("00:00"),q.append("text").attr("class","octext").attr("x",0).attr("y",A+13).attr("text-anchor","middle").text("12:00"),q.append("text").attr("class","octext").attr("x",A+5).attr("y",3).attr("text-anchor","start").text("06:00"),q.append("text").attr("class","octext").attr("x",-(A+5)).attr("y",3).attr("text-anchor","end").text("18:00");var E={},N={},U={},V={cix:null,instagram:null,twitter:null},X={cix:[],instagram:[],twitter:[]},z={cix:"rgba(152,78,163,1)",instagram:"rgba(77,175,74,1)",twitter:"rgba(55,126,184,1)"},C={cix:"rgba(152,78,163,0.2)",instagram:"rgba(77,175,74,0.2)",twitter:"rgba(55,126,184,0.2)"};for(var D in X){for(e=0;24>e;e++)X[D].push(0);E[D]=m.append("g").attr("transform","translate("+g/2+","+p/2+")"),N[D]=m.append("g").attr("transform","translate("+g/2+","+p/2+")"),U[D]=d3.scale.linear().range([0,1]),V[D]=d3.select("#legend_"+D+" div").append("svg").attr("height",_),"cix"!==D?V[D].attr("width",I):V[D].attr("width",I/2)}d3.json("http://tsb.sebastianmeier.eu/static/info.json",function(r,a){if(r)return console.error(r);for(var e in X){var n=-Number.MAX_VALUE;switch(e){case"cix":for(var i=[66,48,40,32,29,27,23,19,17,16,14,14,14,15,18,20,23,28,32,37,40,45,46,49,53,54,57,60,65,69,67,71,76,74,71,77,75,78,88,74,78,84,83,87,81,74,74,72,66],s=[],l=0;l<i.length;l++)s.push({x:l/2,y:i[l]});break;case"instagram":var s=t.reorder("instagram",a);break;case"twitter":var s=t.reorder("twitter",a)}for(X[e]=s,l=0;l<s.length;l++)s[l].y>n&&(n=s[l].y);U[e].domain([0,n]),E[e].selectAll("circle").data(X[e]).enter().append("circle").attr("cx",function(t,r){var a=R(t.x,t.y,U[e]);return a[0]}).attr("cy",function(t,r){var a=R(t.x,t.y,U[e]);return a[1]}).style("fill",z[e]).attr("r",1);var c=d3.svg.line().x(function(t,r){var a=R(t.x,t.y,U[e]);return a[0]}).y(function(t,r){var a=R(t.x,t.y,U[e]);return a[1]}),o=d3.svg.line().x(function(t,r){var a=j(t.x,t.y,U[e]);return a[0]}).y(function(t,r){var a=j(t.x,t.y,U[e]);return a[1]});if(N[e].append("path").attr("d",function(){return c(X[e])+" Z"}).style("stroke",z[e]).style("fill",C[e]).attr("mask","url(#hole)").attr("class",e),V[e].append("path").attr("d",function(){return o(X[e])+" Z"}).style("stroke",z[e]).style("fill",C[e]).attr("transform","translate("+_/2+" "+_/2+")"),V[e].append("circle").attr("cx",0).attr("cy",0).attr("r",P-2).style("stroke",z[e]).style("fill","#fff").attr("transform","translate("+_/2+" "+_/2+")"),"cix"!==e)for(V[e].append("line").attr("x1",I/2).attr("x2",I/2).attr("y1",0).attr("y2",_).attr("stroke","rgba(0,0,0,0.2)"),l=0;6>l;l++)V[e].append("circle").attr("cx",I-_+10+Math.random()*(I-_-12)).attr("cy",Math.random()*(_-4)+2).attr("r",2).style("fill",z[e]).style("stroke","none")}});var G,H,J,K,O,Q,S,T={twitter:null,instagram:null};v.append("image").attr("xlink:href","images/pulse_background_lg.png").attr("x",0).attr("y",0).attr("width",542).attr("height",441);for(var W=0;24>W;W++)v.append("image").attr("xlink:href","http://prjcts.sebastianmeier.eu/tsb/images/animation_"+W+".png").attr("x",0).attr("class","animationLayer").attr("id","animationLayer_"+W).attr("y",0).attr("width",542).attr("height",441);requestAnimationFrame(t.iterate)})},t.iterate=function(){a++,a>23&&(a=0),d3.selectAll(".animationLayer").style("display","none"),d3.select("#animationLayer_"+a).style("display","block"),d3.selectAll("path.bg-pattern.odd").style("opacity",.01),d3.selectAll("path.bg-pattern.even").style("opacity",.03);var r=a-2;0>r&&(r+=24);var e=a-3;0>e&&(e+=24);var n=a-4;0>n&&(n+=24),d3.select("path.bg-"+r).style("opacity",.2),d3.select("path.bg-"+e).style("opacity",.1),d3.select("path.bg-"+n).style("opacity",.05),d3.select("path.bg-"+(a-1)).style("opacity",.3),d3.select(".timetext").text(a),requestAnimationFrame(debouncer(t.iterate,100))},t.reorder=function(t,r){var a=[];for(var e in r.histogram[t])a.push({x:e,y:parseInt(r.histogram[t][e])});return a},t}