function Timeline(){function e(e){var t=e.append("g");t.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(v);var n=t.append("g").attr("class","y axis").call(f);n.selectAll("text").attr("x",-6),n.selectAll("g").filter(function(e){return e}).classed("minor",!0)}var t={},n={top:50,right:15,bottom:50,left:30},r=390-n.left-n.right,a=650-n.top-n.bottom,l=d3.scale.linear().range([0,r]).domain([2011,2015]),i=[0,25,50,70,85,95,100],c=a/(i.length-1),s=[6*c,5*c,4*c,3*c,2*c,c,0],o=d3.scale.linear().range(s).domain(i),u=d3.scale.category20(),d={leitung16:{},leitung50:{}},v=d3.svg.axis().scale(l).orient("bottom").tickValues([2011,2012,2013,2015]).tickFormat(d3.format("")),f=d3.svg.axis().scale(o).orient("left").tickSize(-r),k=d3.svg.line().x(function(e){return l(e.jahr)}).y(function(e){return o(e.mean)}),p=d3.svg.line().x(function(e){return l(e.jahr)}).y(function(e){return o(e.value)}),y=d3.select("#compare-legend").append("div").classed("menu",!0),h=d3.select("#compare .chart"),m={activeMenu:!1,item:null},g={leitung16:"> 16Mbit",leitung50:"> 50Mbit"};return t.load=function(t){var i=d3.nest().key(function(e){return e.type}).key(function(e){return e.bezirk}).key(function(e){return e.jahr}).rollup(function(e){var t=d3.mean(e,function(e){return e.value});return e.forEach(function(e){e.mean=t}),t}).entries(t);i.forEach(function(e,t,n){e.values.forEach(function(t,n,r){d[e.key][t.key]=t.values[2].values})});var c=d3.nest().key(function(e){return e.type}).key(function(e){return e.bezirk}).key(function(e){return e.ortsteil}).entries(t),s=d3.nest().key(function(e){return e.bezirk}).entries(t);s.forEach(function(e){e.mean=parseInt(d3.mean(e.values.filter(function(e){return 2015===e.jahr}),function(e){return e.value}))}),s.sort(function(e,t){return t.mean-e.mean}),y.on("mouseout",function(e){m.activeMenu||h.classed("active",!1).selectAll(".bezirke").classed("active",!1)});var u=y.selectAll("div").data(s).enter().append("div").classed("entry",!0).on("click",function(e){y.selectAll(".entry").classed("hover",!1),m.item===e.key&&m.activeMenu?(m.activeMenu=!1,h.selectAll(".bezirke").selectAll(".ortsteil").transition().attr("d",function(e){return k(e.values)}).each("end",function(e,t){0===t&&h.classed("expand",!1).classed("active",!1)})):(m.activeMenu=!0,h.classed("expand",!0).classed("active",!0),h.selectAll(".bezirke").selectAll(".ortsteil").transition().attr("d",function(e){return k(e.values)}),h.selectAll(".bezirke").classed("active",function(t){return e.key===t.key}).filter(".active").moveToFront().selectAll(".ortsteil").transition().attr("d",function(e){return p(e.values)})),m.item=e.key,y.selectAll(".entry").classed("active",function(t){return e.key===t.key&&m.activeMenu}),tooltip.hide()}).on("mouseenter",function(e){m.activeMenu||(y.selectAll(".entry").classed("hover",function(t){return t.key===e.key}),h.classed("active",!0).selectAll(".bezirke").classed("active",function(t){return e.key===t.key}).filter(".active").moveToFront())});u.append("div").text("Ã—").classed("close",!0),u.append("div").text(function(e){return e.mean+"%"}).classed("labell",!0),u.append("div").classed("labell",!0).text(function(e,t){return e.key});var v=h.selectAll("div").data(c).enter().append("div").each(function(e){return e}).attr("class","col col-xs-12 col-sm-4 col-lg-4").append("svg").attr("id",function(e){return e.key}).attr("viewBox","0 0 "+(r+n.left+n.right)+" "+(a+n.top+n.bottom)).append("g").attr("transform","translate("+n.left+","+n.top+")").call(e).append("g");v.append("text").text(function(e){return g[e.key]}).attr("y",-10);var f=v.selectAll(".bezirke").data(function(e){return e.values}).enter().append("g").attr("class","real").attr("data-key",function(e){return d3.select(this.parentNode).data()[0].key}).classed("bezirke",!0),b=v.selectAll(".bezirke.alpha").data(function(e){return e.values}).enter().append("g").attr("class","alpha").attr("data-key",function(e){return d3.select(this.parentNode).data()[0].key}).classed("bezirke",!0);[f,b].forEach(function(e,t,r){e.selectAll(".ortsteil").data(function(e){return e.values}).enter().append("path").attr("class",function(e){return e.key in d.leitung50?"overbezirk":"normalbezirk"}).classed("ortsteil",!0).attr("d",function(e){return k(e.values)}).on("mouseenter",function(e){var t=d3.select(this.parentNode).datum(),r=d3.select(this.parentNode).attr("data-key"),a=$("#leitung50").width()/390,i=$("#"+r).offset(),c=i.left+(l(e.values[2].jahr)+n.left)*a;if(0==d3.select(this).attr("class").indexOf("overbezirk"))var s=i.top+(o(e.values[2].mean)+n.top)*a+3;else var s=i.top+(o(e.values[2].value)+n.top)*a+3;y.selectAll(".entry").classed("hover",function(e){return e.key===t.key&&!m.activeMenu}),h.classed("hover",!0).selectAll(".bezirke").classed("active",function(e){return t.key===e.key}).filter(".active").moveToFront(),h.selectAll(".bezirke").selectAll(".ortsteil").classed("hover",function(t){return e.key===t.key}).filter(".hover").moveToFront();var u=m.activeMenu?e.key:t.key;tooltip.content("<strong>"+u+"</strong>"),tooltip.position([c,s]),tooltip.show()}).on("mouseleave",function(e){y.selectAll(".entry").classed("hover",!1),h.classed("hover",!1).selectAll(".bezirke").classed("hover",!1).selectAll(".ortsteil").classed("hover",!1),tooltip.hide()}).on("click",function(e){var t=d3.select(this.parentNode).datum(),n=y.selectAll(".entry").filter(function(e){return t.key===e.key}).node().click()})})},t}